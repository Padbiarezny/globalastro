<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GlobalAstro</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    h1 { text-align: center; }
    label { display: block; margin-top: 10px; }
    input, select, textarea, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    textarea { resize: vertical; }
    button { background: #007bff; color: white; border: none; margin-top: 20px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .lang { margin-top: 10px; text-align: center; }
    .lang button { width: 48%; margin: 1%; }
    #result { white-space: pre-wrap; margin-top: 10px; }
  </style>
</head>
<body>
<div class="container">
  <h1 id="form-title">GlobalAstro</h1>

  <label id="label-dob">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è / Date of Birth</label>
  <input type="date" id="dob">

  <label id="label-place">–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è / Place of Birth</label>
  <input type="text" id="place">

  <label id="label-gender">–ü–æ–ª / Gender</label>
  <select id="gender">
    <option value="–º—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π / Male</option>
    <option value="–∂–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π / Female</option>
  </select>

  <label id="label-time">–í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) / Time of Birth (optional)</label>
  <input type="time" id="time">

  <label id="label-question">–í–∞—à –≤–æ–ø—Ä–æ—Å / Your question</label>
  <textarea id="question" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å..." rows="2"></textarea>

  <button type="button" onclick="submitData()" id="get-horoscope-btn">–ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø / Get Horoscope</button>

  <div class="lang">
    <button onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
    <button onclick="setLang('en')">üá¨üáß English</button>
  </div>
</div>

<script>
let currentLang = 'ru';

function setLang(lang) {
  currentLang = lang;
  if (lang === 'ru') {
    document.getElementById("form-title").innerText = "GlobalAstro";
    document.getElementById("label-dob").innerText = "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è";
    document.getElementById("label-place").innerText = "–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è";
    document.getElementById("label-gender").innerText = "–ü–æ–ª";
    document.getElementById("label-time").innerText = "–í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)";
    document.getElementById("label-question").innerText = "–í–∞—à –≤–æ–ø—Ä–æ—Å";
    document.getElementById("question").placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å...";
    document.getElementById("get-horoscope-btn").innerText = "–ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø";
  } else {
    document.getElementById("form-title").innerText = "GlobalAstro";
    document.getElementById("label-dob").innerText = "Date of Birth";
    document.getElementById("label-place").innerText = "Place of Birth";
    document.getElementById("label-gender").innerText = "Gender";
    document.getElementById("label-time").innerText = "Time of Birth (optional)";
    document.getElementById("label-question").innerText = "Your question";
    document.getElementById("question").placeholder = "Type your question...";
    document.getElementById("get-horoscope-btn").innerText = "Get Horoscope";
  }
}

function submitData() {
  const dob = document.getElementById("dob").value;
  const place = document.getElementById("place").value;
  const gender = document.getElementById("gender").value;
  const time = document.getElementById("time").value;
  const question = document.getElementById("question").value || 
      (currentLang === 'ru' ? "–î–∞–π –º–Ω–µ –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é" : "Give me a horoscope for next week");

  const data = { dob, place, gender, time, question };

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å—Ä–∞–∑—É (—á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ—Å—å popup-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –±—Ä–∞—É–∑–µ—Ä–∞)
  const win = window.open('', '_blank');
  win.document.write('<h2 style="font-family:sans-serif;">‚è≥ –ñ–¥—ë–º –æ—Ç–≤–µ—Ç–∞...</h2>');

  fetch("https://globalastro.onrender.com/horoscope", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
    .then(response => response.json())
    .then(result => {
      if (result.response) {
        win.document.body.innerHTML = '<div style="font-family:sans-serif;padding:24px;"><h2>üîÆ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h2><div>' +
          result.response.replace(/\n/g, "<br>") +
          '</div><br><button onclick="window.close()" style="margin-top:24px;padding:10px 20px;font-size:18px;border:none;border-radius:5px;background:#007bff;color:#fff;cursor:pointer;">–ó–∞–∫—Ä—ã—Ç—å</button></div>';
      } else if (result.error) {
        win.document.body.innerHTML = '<b>–û—à–∏–±–∫–∞:</b> ' + result.error;
      } else {
        win.document.body.innerHTML = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.';
      }
    })
    .catch(e => {
      win.document.body.innerHTML = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + e;
    });
}
</script>
</body>
</html>
